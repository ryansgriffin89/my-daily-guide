<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <title>My Daily Guide</title>
  <meta name="theme-color" content="#121212" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIk15IERhaWx5IEd1aWRlIiwKICAic2hvcnRfbmFtZSI6ICJEYWlseSIsCiAgInN0YXJ0X3VybCI6ICIuIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjMTIxMjEyIiwKICAidGhlbWVfY29sb3IiOiAiIzFFMUUxRSIKfQ==" />

  <style>
    :root {
      --primary: #D0BCFF; --primary-dim: rgba(208, 188, 255, 0.1);
      --bg: #121212; --surface: #1E1E1E; --surface-2: #2C2C2C;
      --on-surface: #E6E1E5; --muted: #938F99; --success: #81C784; 
      --radius: 16px; --font: 'Roboto', system-ui, sans-serif;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; background: var(--bg); color: var(--on-surface); font-family: var(--font); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
    
    /* SCROLLABLE MAIN AREA */
    main { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }
    
    /* HEADER */
    header { padding: 16px 20px; background: var(--surface); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.3); z-index: 10; }
    .brand h1 { font-size: 18px; color: var(--primary); margin: 0; }
    .brand p { margin: 0; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); }

    /* CARDS & TASKS */
    .card { background: var(--surface); border-radius: var(--radius); padding: 20px; margin-bottom: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
    .hero-header { display: flex; justify-content: space-between; align-items: flex-start; }
    .streak-badge { background: var(--surface-2); padding: 6px 12px; border-radius: 20px; font-weight: bold; border: 1px solid #333; font-size: 14px; }
    
    .task-item { background: var(--surface-2); border-radius: 12px; padding: 16px; margin-bottom: 12px; display: flex; flex-direction: column; transition: background 0.2s; }
    .task-row { display: flex; align-items: flex-start; gap: 16px; width: 100%; }
    
    .chk { width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--muted); flex-shrink: 0; display: grid; place-items: center; margin-top: 2px; cursor: pointer; }
    .chk.done { background: var(--success); border-color: var(--success); color: #000; }
    
    .task-content { flex: 1; }
    .task-title { font-size: 16px; margin-bottom: 4px; font-weight: 500; }
    .task-meta { font-size: 11px; color: var(--primary); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
    
    /* EXPANDABLE DETAILS */
    .details-box { 
      background: rgba(0,0,0,0.2); margin-top: 12px; padding: 12px; border-radius: 8px; 
      font-size: 13px; color: var(--muted); line-height: 1.6; display: none; 
      border-left: 2px solid var(--primary);
    }
    .task-item.expanded .details-box { display: block; }
    .toggle-text { font-size: 11px; color: var(--muted); text-decoration: underline; margin-top: 4px; cursor: pointer; }

    /* SUB-LISTS inside Details */
    .sub-list { list-style: none; padding: 0; margin: 8px 0 0 0; }
    .sub-list li { display: flex; gap: 8px; margin-bottom: 6px; align-items: flex-start; }
    .sub-list li:before { content: "‚Ä¢"; color: var(--primary); }

    /* BOTTOM NAV */
    nav.tabs { position: fixed; bottom: 0; width: 100%; background: var(--surface); display: flex; justify-content: space-around; padding: 10px 0 25px 0; border-top: 1px solid #333; z-index: 20; }
    .tab-btn { background: none; border: none; color: var(--muted); font-size: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 16px; border-radius: 20px; }
    .tab-btn.active { color: var(--primary); background: var(--primary-dim); }
    .tab-icon { font-size: 20px; }

    /* UTILS */
    .btn { background: var(--primary); color: #000; border: none; padding: 8px 16px; border-radius: 8px; font-weight: bold; cursor: pointer; }
    .btn.ghost { background: transparent; color: var(--muted); }
    
    /* DIALOG */
    dialog { background: var(--surface); color: white; border: none; border-radius: var(--radius); width: 90%; max-width: 400px; padding: 20px; }
    dialog::backdrop { background: rgba(0,0,0,0.8); backdrop-filter: blur(2px); }
    .chip-group { display: flex; gap: 8px; flex-wrap: wrap; margin: 10px 0; }
    .chip { background: #333; padding: 8px 12px; border-radius: 20px; font-size: 13px; border: 1px solid transparent; cursor: pointer; }
    .chip.active { background: var(--primary-dim); color: var(--primary); border-color: var(--primary); }
  </style>
</head>

<body>
  <header>
    <div class="brand">
      <h1>Daily Guide</h1>
      <p>Operating System</p>
    </div>
    <button class="btn ghost" onclick="document.getElementById('contextDialog').showModal()">‚òÄÔ∏è Check-in</button>
  </header>

  <main id="view">
    </main>

  <nav class="tabs" id="navTabs"></nav>

  <dialog id="contextDialog">
    <form method="dialog">
      <h3 style="margin-top:0">Morning Check-in</h3>
      <p>Pain / Recovery Status:</p>
      <div class="chip-group" id="painChips">
        <div class="chip" onclick="app.setContext('pain', 'green', this)">üü¢ Green (Good)</div>
        <div class="chip" onclick="app.setContext('pain', 'yellow', this)">üü° Yellow (Sore)</div>
        <div class="chip" onclick="app.setContext('pain', 'red', this)">üî¥ Red (Injured)</div>
      </div>
      <p>Environment:</p>
      <div class="chip-group" id="envChips">
        <div class="chip" onclick="app.setContext('env', 'home', this)">üè† Home</div>
        <div class="chip" onclick="app.setContext('env', 'gym', this)">üèãÔ∏è Gym</div>
      </div>
      <div style="margin-top:20px; text-align:right">
        <button class="btn">Save</button>
      </div>
    </form>
  </dialog>

  <script>
    // --- DATA FROM YOUR PDFs AND SUPPLEMENT LIST ---
    const GUIDE_DATA = {
      tabs: [
        { id: "today", label: "Today", icon: "üìÖ" },
        { id: "rehab", label: "Rehab", icon: "ü¶¥" },
        { id: "workouts", label: "Training", icon: "üí™" },
        { id: "skills", label: "Skills", icon: "üé∏" }
      ],
      tasks: [
        // --- MORNING ---
        { 
          id: "m_protocols", title: "Morning Rehab Protocols", block: "morning", tags: ["rehab", "core"],
          why: "Prepares body structure", 
          how: "Perform specific drills for neck and scapula.",
          details: [
            "Neck: Scalene release & Sternocleidomastoid decompression",
            "Neck: Deep neck flexor activations",
            "Diaphragm: Activation drills & Breath support",
            "Scapula: Serratus anterior drills"
          ]
        },
        { 
          id: "m_supps", title: "Morning Stack", block: "morning", tags: ["supps"],
          why: "Metabolism, Brain, Inflammation",
          how: "Take with first meal/breakfast.",
          details: [
            "Multivitamin (One A Day)",
            "Vitamin D3 (5,000 IU) - Hormones",
            "Omega-3 (Salmon Oil) - Inflammation",
            "Choline + Inositol - Focus",
            "Probiotic (Jarrow) - Gut Health",
            "Optional: Acetyl-L-Carnitine (Fat burn)"
          ]
        },

        // --- MIDDAY / WORKOUT ---
        { 
          id: "w_prep", title: "Pre-Workout / Midday", block: "midday", tags: ["workout"],
          why: "Fuel & Activation",
          how: "Prepare systems 30m before training.",
          details: [
            "Creatine (5g) - Saturation",
            "Protein (Whey Isolate) - Repair",
            "Posture Reset (every 60-90 mins)",
            "Knee Protocol: VMO activation"
          ]
        },
        { 
          id: "w_upper", title: "Upper Body Strength", block: "midday", tags: ["workout"],
          why: "Strength & Hypertrophy",
          how: "Focus on form cues and safety notes.",
          details: [
            "Warm-up: Scap circles & Rhomboid decompression",
            "Main Lifts: Refer to PDF split",
            "Rehab integration: Low trap activation between sets"
          ]
        },
        { 
          id: "diet_omad", title: "OMAD / Main Meal", block: "midday", tags: ["diet"],
          why: "Anti-inflammatory & Weight Control",
          how: "Target 185lb macro profile.",
          details: [
            "Anti-inflammatory focus",
            "Low-cholesterol strategy",
            "Hydration & Electrolytes"
          ]
        },

        // --- EVENING ---
        { 
          id: "e_family", title: "Family System (3 & 5yo)", block: "evening", tags: ["family"],
          why: "Bonding & Development",
          how: "Dedicated phone-free block.",
          details: [
            "Ages 3 & 5 Rituals",
            "Weekend: Restaurant activity training",
            "Couple connection routine"
          ]
        },
        { 
          id: "e_guitar", title: "Guitar Training", block: "evening", tags: ["skill"],
          why: "Dexterity & Mastery",
          how: "Follow Section 9 of Guide.",
          details: [
            "Finger dexterity drills",
            "Beginner chord system practice",
            "Strumming mastery",
            "Song-learning system"
          ]
        },
        { 
          id: "e_vocal", title: "Advanced Singing", block: "evening", tags: ["skill"],
          why: "Range & Tone",
          how: "Section 4 Drills.",
          details: [
            "False-fold rasp technique",
            "Range mapping",
            "Video practice flow"
          ]
        },
        { 
          id: "e_stack", title: "Sleep Stack", block: "evening", tags: ["supps", "sleep"],
          why: "Recovery & Cortisol Control",
          how: "Take 45-60m before bed.",
          details: [
            "Ashwagandha (1,000 mg) - Stress/Cortisol",
            "Magnesium Glycinate (200-400mg) - Relaxation",
            "Optional: HMB (Muscle preservation)"
          ]
        }
      ]
    };

    // --- APP LOGIC ---
    const app = {
      state: {
        tab: 'today',
        date: new Date().toLocaleDateString('en-CA'),
        completions: JSON.parse(localStorage.getItem('mdg_done') || '{}'),
        context: JSON.parse(localStorage.getItem('mdg_ctx') || '{"pain":"green","env":"home"}')
      },
      init() {
        this.renderTabs();
        this.renderView();
        this.updateContextUI();
      },
      save() {
        localStorage.setItem('mdg_done', JSON.stringify(this.state.completions));
        localStorage.setItem('mdg_ctx', JSON.stringify(this.state.context));
        this.renderView();
      },
      toggleTask(id) {
        const key = `${this.state.date}_${id}`;
        if (this.state.completions[key]) delete this.state.completions[key];
        else this.state.completions[key] = true;
        this.save();
      },
      setContext(type, val, el) {
        this.state.context[type] = val;
        this.updateContextUI();
        this.save();
      },
      updateContextUI() {
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        // Re-highlight based on state (simplified for demo)
        // In real app, match specific IDs
      },
      renderTabs() {
        document.getElementById('navTabs').innerHTML = GUIDE_DATA.tabs.map(t => `
          <button class="tab-btn ${this.state.tab === t.id ? 'active' : ''}" onclick="app.switchTab('${t.id}')">
            <span class="tab-icon">${t.icon}</span>
            <span>${t.label}</span>
          </button>
        `).join('');
      },
      switchTab(id) { this.state.tab = id; this.renderTabs(); this.renderView(); },
      
      renderView() {
        const view = document.getElementById('view');
        let tasksToShow = GUIDE_DATA.tasks;
        
        if (this.state.tab !== 'today') {
           // Filter based on tab tags
           const mapping = { 'rehab': ['rehab'], 'workouts': ['workout', 'diet'], 'skills': ['skill', 'family'] };
           const tags = mapping[this.state.tab] || [];
           tasksToShow = GUIDE_DATA.tasks.filter(t => t.tags.some(tag => tags.includes(tag)));
        }

        const doneCount = GUIDE_DATA.tasks.filter(t => this.state.completions[`${this.state.date}_${t.id}`]).length;
        const total = GUIDE_DATA.tasks.length;
        
        let html = '';
        if(this.state.tab === 'today') {
           html += `
             <div class="card hero-header">
               <div class="brand">
                 <h1>${new Date().toLocaleDateString('en-US', {weekday:'long', month:'short', day:'numeric'})}</h1>
                 <p>${doneCount} / ${total} Tasks Complete</p>
               </div>
               <div class="streak-badge">üî• ${doneCount > 0 ? 1 : 0}</div>
             </div>
           `;
        }

        const blocks = ['morning', 'midday', 'evening'];
        blocks.forEach(block => {
          const blockTasks = tasksToShow.filter(t => t.block === block);
          if (blockTasks.length) {
            html += `<h3 style="color:var(--primary); margin-top:20px; text-transform:capitalize">${block}</h3>`;
            html += blockTasks.map(t => this.createTaskCard(t)).join('');
          }
        });
        
        if (html === '') html = '<p style="text-align:center; margin-top:50px">No tasks for this category.</p>';
        view.innerHTML = html;
      },

      createTaskCard(t) {
        const isDone = !!this.state.completions[`${this.state.date}_${t.id}`];
        // Create Details List
        const detailsHtml = t.details ? 
          `<ul class="sub-list">${t.details.map(d => `<li>${d}</li>`).join('')}</ul>` : '';

        return `
          <div class="task-item ${isDone ? 'done' : ''}" onclick="this.classList.toggle('expanded')">
            <div class="task-row">
              <div class="chk ${isDone ? 'done' : ''}" onclick="event.stopPropagation(); app.toggleTask('${t.id}')">
                ${isDone ? '‚úì' : ''}
              </div>
              <div class="task-content">
                <div class="task-title">${t.title}</div>
                <div class="task-meta">${t.tags.join(' ‚Ä¢ ')}</div>
                <div class="toggle-text">Tap to view details</div>
              </div>
            </div>
            <div class="details-box">
              <strong>Why:</strong> ${t.why}<br>
              <strong>How:</strong> ${t.how}
              ${detailsHtml}
            </div>
          </div>
        `;
      }
    };
    app.init();
  </script>
</body>
</html>

